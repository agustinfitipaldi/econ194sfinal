---
title: "Final Presentation"
author: "Tony Segal"
date: "June 3, 2025"
format: pdf
---

```{r}
#| warning: false
#| message: false
#| echo: false

library(dplyr)
library(readr)
library(gt)
library(ggplot2)
library(estimatr)
library(modelsummary)

lbank <- read_csv("combined_fdic_data_log.csv")

names(lbank)[10] <- "core_deposit"
lbank$State <- as.factor(lbank$State)
lbank$core_deposit <- as.numeric(lbank$core_deposit)
lbank$Date <- as.Date(lbank$Date, format = "%m/%d/%Y")

# Filter out Nevada
lbank <- lbank %>%
  filter(State != "Nevada")

```


$$
Y_{it} = \beta_0 + \beta_1X_{it} + \gamma_i + \tau_t + \epsilon_{it}
$$
```{r}
lbank$west <- ifelse(lbank$State %in% c("California", "Oregon", "Arizona", "Washington", "Idaho", "Utah", "Montana", "Wyoming", "Colorado", "New Mexico"), 1, 0)
lbank$year <- format(lbank$Date, "%Y")
lbank$post <- ifelse(lbank$Date >= as.Date("2023-03-31"), 1, 0)
lbank$post <- as.factor(lbank$post)
lbank$west <- as.factor(lbank$west)

reg <- lm_robust(core_deposit ~ west + post + west*post, data = lbank, se_type = "HC1")
summary(reg)
```
```{r}
# Calculate averages for Western and non-Western states
avg_deposits <- lbank %>%
  filter(Date <= as.Date("2022-12-31")) %>%
  group_by(Date, west) %>%
  summarize(avg_core_deposit = mean(core_deposit, na.rm = TRUE)) %>%
  mutate(Region = ifelse(west == 1, "Western States", "Non-Western States"))

# Create single plot with averages
ggplot(data = avg_deposits,
       aes(x = Date, y = avg_core_deposit, color = Region)) +
  geom_line(size = 1.2) +
  labs(title = "Average Core Deposits Over Time - Western vs Non-Western States",
       x = "Date",
       y = "Core Deposits (log)",
       color = "Region") +
  theme_minimal() +
  theme(legend.position = "right",
        plot.title = element_text(size = 12),
        axis.text.x = element_text(angle = 45, hjust = 1))
```